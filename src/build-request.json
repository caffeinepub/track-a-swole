{
  "kind": "build_request",
  "title": "Add Internet Identity authentication with user-specific data storage",
  "projectName": "Track-A-Swole",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-28",
      "text": "Create a login page component that displays when user is not authenticated, prompting them to sign in with Internet Identity and providing a login button that initiates the authentication flow",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ],
        "quotes": [
          "Create an IID2 login so I can save data to storage"
        ]
      },
      "acceptanceCriteria": [
        "Unauthenticated users see a login page with clear messaging about needing to sign in",
        "Login page includes a button that triggers Internet Identity authentication",
        "After successful authentication, user is redirected to the home page"
      ]
    },
    {
      "id": "REQ-29",
      "text": "Update the Layout component in frontend/src/components/Layout.tsx to conditionally render main app navigation only for authenticated users, and display login prompt for unauthenticated users",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ],
        "quotes": [
          "Create an IID2 login so I can save data to storage"
        ]
      },
      "acceptanceCriteria": [
        "Authenticated users see the full app layout with navigation",
        "Unauthenticated users are shown the login page",
        "Authentication state is checked using the useInternetIdentity hook"
      ]
    },
    {
      "id": "REQ-30",
      "text": "Add a logout button to the Layout component header that allows authenticated users to sign out and return to the login page",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ]
      },
      "acceptanceCriteria": [
        "Logout button is visible in the header for authenticated users",
        "Clicking logout clears the user's authentication session",
        "After logout, user is returned to the login page"
      ]
    },
    {
      "id": "REQ-31",
      "text": "Modify the backend Exercise data structure in backend/main.mo to associate each exercise template with the user's Principal ID, ensuring exercises are stored per-user rather than globally",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ],
        "quotes": [
          "It's important that I have history",
          "Create an IID2 login so I can save data to storage"
        ]
      },
      "acceptanceCriteria": [
        "Exercise templates are stored with an owner field containing the user's Principal",
        "Users can only access their own exercise templates",
        "Exercise CRUD operations filter by authenticated user's Principal"
      ]
    },
    {
      "id": "REQ-32",
      "text": "Modify the backend WorkoutSession data structure in backend/main.mo to associate each workout session with the user's Principal ID, ensuring workout history is stored per-user rather than globally",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ],
        "quotes": [
          "It's important that I have history",
          "Create an IID2 login so I can save data to storage"
        ]
      },
      "acceptanceCriteria": [
        "Workout sessions are stored with an owner field containing the user's Principal",
        "Users can only access their own workout history",
        "Session operations (create, complete, retrieve history) filter by authenticated user's Principal"
      ]
    },
    {
      "id": "REQ-33",
      "text": "Update all backend methods in backend/main.mo (addExercise, editExercise, deleteExercise, getExercises, createSession, completeSession, getHistory) to use the caller's Principal for data isolation, ensuring each authenticated user only accesses their own data",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ],
        "quotes": [
          "Create an IID2 login so I can save data to storage"
        ]
      },
      "acceptanceCriteria": [
        "All backend methods retrieve the caller Principal using shared(msg) syntax",
        "Data operations are scoped to the authenticated user's Principal",
        "Users cannot access or modify other users' exercises or workout sessions"
      ]
    },
    {
      "id": "REQ-34",
      "text": "Update frontend query hooks in frontend/src/hooks/useQueries.ts to handle authentication requirements, ensuring backend calls only execute when user is authenticated and actor is available",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ]
      },
      "acceptanceCriteria": [
        "Query hooks check for authenticated state before making backend calls",
        "Queries are disabled when actor is null or user is not authenticated",
        "Loading and error states are properly handled for authentication scenarios"
      ]
    }
  ],
  "constraints": [
    "Preserve the existing useInternetIdentity hook implementation in frontend/src/hooks/useInternetIdentity.ts as it is marked immutable",
    "Preserve the existing useActor hook implementation in frontend/src/hooks/useActor.ts as it is marked immutable",
    "Maintain the single-actor architecture with all Motoko logic in backend/main.mo",
    "Do not modify the existing localStorage persistence logic in ActiveWorkout.tsx",
    "Keep the existing amber/orange color theme and dark mode styling"
  ],
  "nonGoals": [
    "Implementing alternative authentication methods besides Internet Identity",
    "Creating user profile or account management features",
    "Adding social features or sharing workout data between users",
    "Implementing data export or backup functionality",
    "Creating admin or multi-tenant features"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}